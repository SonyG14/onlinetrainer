{% extends "main/base.html" %}
{% load static %}


{% block content %}
<div class="login">
    <div class="log">
        <h2>Вхід</h2>
        <form id="login-form" method="post">
            {% csrf_token %}
            <label for="username">Ім'я користувача:</label><br>
            <input type="text" id="username" name="username" required><br><br>

            <label for="password">Пароль:</label><br>
            <input type="password" id="password" name="password" required><br><br>

            <button type="submit" class="btn">Увійти</button>
        </form>
        <div id="message"></div>
    </div>
</div>

<script>
    document.getElementById('login-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = {
            username: document.getElementById('username').value,
            password: document.getElementById('password').value
        };

        const response = await fetch('/api/token/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (response.ok) {
            document.getElementById('message').innerText = 'Вхід успішний!';
            localStorage.setItem('access_token', data.access);  // зберігаємо токен
            localStorage.setItem('refresh_token', data.refresh);
            localStorage.setItem('username', formData.username); // ← зберігаємо username
            window.location.href = '';
        } else {
            document.getElementById('message').innerText = 'Невірний логін або пароль.';
        }
    });
</script>
{% endblock %}
